<html>
<head>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <title></title>
</head>
<body>
  <div class="container"></div>
  <div>
    <h1>Music Maker</h1>
    <input id="note-string">
    <button onclick="sendNotesToPlay(0)">Push Play</button>
  </div>
</body>
<script>

    var ctx = new window.webkitAudioContext || new window.AudioContext;
      
    function stringParser() {
      var noteString = document.getElementById("note-string").value.toLowerCase();  
      var noteArr =  noteString.match(/([a-g]+#|[a-g])([whqes])(\d)/g); 
      return noteArr;
      // expected input ex: 'co1d#s4fw2', etc
      // expected output ['co1' 'd#s4' 'fw2'], etc
    }
    
    function sendNotesToPlay(index, arr) {   
      var arr = stringParser();
      //TODO: convert arr[index] into its own array of ["note", "duration", "octave"] (currently "notedurationoctave")
      
      if (arr.length > index) {
        setTimeout(function() {
          play(arr);//arr[index]);
          sendNotesToPlay(++index);
        }, 1000)
      }
    }
    
    function noteDuration(char) {
      var duration = char;      
       if (duration === "w")
      sustain = 4
      
      if (duration === "h")
      sustain = 2
      
      if (duration === "q")
      sustain = 1
    
      if (duration === "o")
      sustain = .5
      
      if (duration === "s")
      sustain = .25
      
      return sustain;
    }
    
    
    function noteHz(note){
      var note = note;
      var frequencies = {
       	'c': 130.81,
       	'c#': 139.00,
       	'd': 146.83,
       	'd#': 156.00,
       	'e': 164.81,
       	'f': 174.61,
       	'f#': 185.00,
       	'g': 196.00,
       	'g#': 208.00,
       	'a': 220.00,
       	'a#': 233.00,
       	'b': 246.94,
       	};
       	
       	var hertz = frequencies[note];
       	return hertz;
    }
    
    
    function play(arr) {
     
      var octave = arr[2];
      var sustain = noteDuration(arr[1]);
      var hertz = noteHz(arr[0]);  
      var osc = ctx.createOscillator();
      var gainNode = ctx.createGain();
      
      osc.connect(gainNode);
      gainNode.connect(ctx.destination);
      gainNode.gain.value = 0.0;
      gainNode.gain.setTargetAtTime(.75, ctx.currentTime, 0.1);
      gainNode.gain.setTargetAtTime(0.0, ctx.currentTime + sustain, 0.01)
      osc.frequency.value = hertz * octave;
      osc.start();
      osc.stop(ctx.currentTime + sustain + .01);
    }
    
</script>
</html>