<html>
    <head>
        <title>Counterpoint.Elm</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.2.0/milligram.min.css">
    </head>
    <body>
    <div>"I WORK DAMMIT!!!"</div>
        <div id="main"></div>
        <script src="Main.js"></script>
        <script>
            var app = Elm.Main.fullscreen();

            app.ports.send.subscribe(play);

            var ctx = new window.webkitAudioContext || window.AudioContext;
            var i = 0;
            
            function play(note) {
                console.log(note);
                    var osc = ctx.createOscillator();
                    var gainNode = ctx.createGain();
                    var hz = note[i].hz
                    var sustain = note[i].duration; 
                    var octave = note[i].octave

                    osc.connect(gainNode);
                    gainNode.connect(ctx.destination);
                    gainNode.gain.value = 0.0;
                    gainNode.gain.setTargetAtTime(0.75, ctx.currentTime, 0.1);
                    gainNode.gain.setTargetAtTime(0.0, ctx.currentTime + sustain, 0.01);
                    osc.frequency.value = hz * octave / 4;
                    osc.start();
                    osc.stop(ctx.currentTime + sustain + 0.01);
                    console.log(i ,hz,sustain, octave);
                    i++;
            }
        </script>
    </body>
    
</html>
